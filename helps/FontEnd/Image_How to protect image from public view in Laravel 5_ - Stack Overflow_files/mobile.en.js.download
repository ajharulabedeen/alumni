"use strict";StackExchange.mobile=function(){function e(e){void 0===e&&(e=$(".js-search-container").closest(".subheader")),e.on("submit",".js-search-container.js-no-submit",function(e){e.preventDefault(),e.stopPropagation()}),e.on("click",".js-search-trigger",function(t){e.find(".js-search-container").show(),e.find(".js-search-input").focus(),t.preventDefault()}),e.on("click",".js-search-container .icon-clear",function(t){e.find(".js-search-container .js-search-input").val(""),t.preventDefault()}),e.on("click",".js-search-container .js-cancel",function(t){e.find(".js-search-container").hide(),t.preventDefault()}),StackExchange.options.user.ajaxSearch&&e.on("submit","form.js-search-container:not(.js-no-submit)",function(e){var t=location.pathname+location.hash.replace(/%20/g,"+"),n=$(this).attr("action")+"#"+$(this).serialize();return t!==n?location.href=n:location.reload(!0),e.preventDefault(),!1})}function t(e,t){i(e,t,e.data("postid"))}function n(e,t){i(e,t,e.data("questionid"))}function i(e,t,n){var i=o(n);i.children().not("#popup-flag-post, #popup-close-question").remove(),e.detach().appendTo(i),scrollTo(0,t.offset().top),t.addClass("util-link-active"),e.on("popupClose",function(){$(".util-link-active").removeClass("util-link-active"),i.empty()}),i.show()}function o(e){return $(".menu-popup-container[data-postid="+e+"]")}function r(){return $('[data-controller="se-mod-button"]').length>0?(StackExchange.moderator.initMenus(),void 0):void 0}var a,s=function(){$(".submit-on-change").change(function(){$(this).closest("form").submit()})},c=null,u=function(){null==c&&(c=setInterval(function(){var e=$(".dot1"),t=$(".dot2"),n=$(".dot3"),i=$(".dot4");d(e,".dot2")||d(t,".dot3")||d(n,".dot4")||d(i)||$.each(e,function(e,t){var n=$(t).closest(".mobile-spinner").attr("spinnerPadding");$(t).css({"paddingLeft":n+"px"})})},20))},l=function(){null!=c&&0==$(".mobile-spinner").length&&(clearInterval(c),c=null)},d=function(e,t){var n=!1;return $.each(e,function(e,i){var o=$(i),r=o.css("padding-left");if(null!=r&&"0px"!=r){var a=+r.substring(0,r.length-2);if(a--,o.css({"paddingLeft":a+"px"}),t){var s=o.siblings(t),c=s.css("padding-left");c=+c.substring(0,c.length-2),c++,s.css({"paddingLeft":c+"px"})}n=!0}}),n},f=function(){$(".spoiler").each(function(e,t){var n=$(t);n.removeClass("spoiler").addClass("spoiler-overlay");var i=n.children();i.remove(),n.append('<div class="spoiler-click-to-show">Click to show spoiler</div>'),n.one("click",function(){n.empty(),n.append(i),n.removeClass("spoiler-overlay").addClass("spoiler")})})},p=function(e,t,n,i){var o=e.val(),r=o.lastIndexOf(" ",n),a=o.indexOf(" ",i);-1==r?r=0:r++,-1==a&&(a=o.length+1);var s=o.substring(0,r)+t+o.substring(a);e.val($.trim(s));var c=r+t.length+1;c>s.length&&e.val(e.val()+" "),e.focus()[0].setSelectionRange(c,c)},h={},g=function(e,t,n,i,o){var r=h[e];if(r){if(r.clear)return t(),void 0;for(var a=r.tags,s=0;s<a.length;s++)if(a[s]==e&&a[s].length>3)return t(),void 0;return n(a,i,o),void 0}$.get("/filter/tags",{"q":e},function(r){if(!$.trim(r))return h[e]={"clear":!0},t(),void 0;for(var a=r.split("\n"),s=[],c=0;c<a.length;c++){var u=a[c].split("|");s[s.length]=u[0]}h[e]={"tags":s};for(var c=0;c<s.length;c++)if(s[c]==e&&s[c].length>3)return t(),void 0;n(s,i,o)})},m=function(e){var t=e.siblings(".mobile-tag-autocomplete"),n=function(){t.hide()},i=function(i,o,r){t.empty();for(var a=0;a<i.length&&5>a;a++){var s=$('<a class="post-tag"></a>');s.text(i[a]),s.one("click",function(t,i,o){return function(){n(),p(e,t,i,o)}}(i[a],o,r)),t.append(s),t.append($("<span>&nbsp;</span>"))}t.show()},o="";return function(){var t=e.val();if(!t||!$.trim(t))return n(),void 0;o=t;var r=e[0].selectionStart;if(" "==t[r-1])return n(),void 0;var a=t.lastIndexOf(" ",r-1);-1==a&&(a=0);var s=t.indexOf(" ",a+1);-1==s&&(s=t.length);var c=$.trim(t.substring(a,s));g(c,n,i,a,s)}},v=function(){$.browser&&$.browser.msie||$(".mobile-tag-field").each(function(e,t){var n=$(t),i=m(n),o=setInterval(i,500);n.keyup(function(e){o&&clearInterval(o),(32==e.which||13==e.which)&&i(),o=setInterval(i,500)})})},b=function(){$(".delete-post").each(function(e,t){var n=$(t),i=+n.attr("id").substring("delete-post-link-".length);n.click(function(e){e.stopPropagation(),confirm("Vote to delete this post?")&&StackExchange.vote.submit({"$target":n,"postId":i,"voteTypeId":StackExchange.vote.voteTypeIds.deletion,"success":function(){window.location.reload()}})})}),$(".restore-post").each(function(e,t){var n=$(t),i=+n.attr("id").substring("delete-post-link-".length);n.click(function(e){e.stopPropagation(),confirm("Vote to undelete this post?")&&StackExchange.vote.submit({"$target":n,"postId":i,"voteTypeId":StackExchange.vote.voteTypeIds.undeletion,"success":function(){window.location.reload()}})})})};return{"setUnreadNotificationsCount":function(e){a=e},"initDraft":function(e,t,n,i){if(window.localStorage){var o=$(t),r=$(o.find(".wmd-input")[0]),a=o.find(".tagnames"),s=o.find(".title");a.length>0&&(a=$(a[0])),s.length>0&&(s=$(s[0]));var c="mobile-draft-"+e,u=window.localStorage[c];u&&(u=JSON.parse(u),r.val(u.body),s.val(u.title),a.val(u.tags));var l=function(){r.val()||s.val()||a.val()?window.localStorage[c]=JSON.stringify({"body":r.val(),"title":s.val(),"tags":a.val()}):window.localStorage.removeItem(c)};i&&l();var d=setInterval(l,5e3);$(n).click(function(){clearInterval(d),window.localStorage.removeItem(c)}),r.blur(l),a.blur(l),s.blur(l)}},"applyTagPrefs":function(e,t,n,i){var o=[],r=[];if(i){var a=[],s=[];if(e){for(var c=0;c<e.length;c++)-1==i.indexOf(e[c])&&(/\*/.test(e[c])?r.push(new RegExp(e[c].replace(/([.+])/g,"\\$1").replace(/\*/g,".*"))):a.push(e[c]));e=a}if(t){for(var c=0;c<t.length;c++)-1==i.indexOf(t[c])&&(/\*/.test(t[c])?o.push(new RegExp(t[c].replace(/([.+])/g,"\\$1").replace(/\*/g,".*"))):s.push(t[c]));t=s}}$(".post-tag").each(function(a,s){var c=$(s),u=c.text();if(t){for(var l=!1,d=0;d<t.length;d++)if(u==t[d]){l=!0;break}for(var d=0;d<o.length;d++)if(o[d].test(u)&&-1==i.indexOf(u)){l=!0;break}if(l){var f=c.parents(".-summary").addClass("tagged-ignored");n&&f.hide()}}if(e){for(var p=!1,d=0;d<e.length;d++)if(u==e[d]){p=!0;break}for(var d=0;d<r.length;d++)if(r[d].test(u)&&-1==i.indexOf(u)){p=!0;break}p&&c.parents(".-summary").addClass("tagged-interesting")}})},"shrinkAndShowMore":function(e,t){$(e).each(function(e,n){var i=$(n);if(!(i.height()<=t)){var o={"overflowY":i.css("overflow-y"),"maxHeight":i.css("max-height")};i.css({"overflowY":"hidden","maxHeight":t+"px"});var r=$('<div class="generic-show-more"><a>show more</a></div>');i.after(r),r.click(function(){r.remove(),i.css(o)}),r.css({"backgroundColor":i.css("background-color"),"fontSize":"12px"})}})},"addSpinner":function(e,t){$(e).each(function(e,n){t||(t="loading");var i=$('<span class="mobile-spinner"><span class="spinner-message"></span><span class="dot1">.</span><span class="dot2">.</span><span class="dot3">.</span><span class="dot4">.</span></span>');$(n).append(i),$(i).find(".spinner-message").text(t);var o=$(i).find(".dot1").width()+$(i).find(".dot2").width()+$(i).find(".dot3").width(),r=$(i).find(".spinner-message").width(),a=r+o;$(i).css({"width":a+"px","overflow":"hidden","display":"block"}),$(i).find(".dot1").css({"paddingLeft":2*o+"px"}),$(i).find(".dot2").css({"paddingLeft":"0px"}),$(i).find(".dot3").css({"paddingLeft":"0px"}),$(i).find(".dot4").css({"paddingLeft":"0px"}),$(i).attr("spinnerPadding",2*o)}),u()},"removeSpinner":function(e){$(e).find(".mobile-spinner").remove(),l()},"init":function(){$(function(){s(),e(),v(),f(),StackExchange.vote_closingAndFlagging&&StackExchange.vote_closingAndFlagging.init({"closeShowPopup":n,"flagShowPopup":t}),b(),r()})},"initSearchBox":e}}(),StackExchange.mobile.overlay=function(){function e(){r.on("change",function(){var e="_blocked";$(this).hasClass("js-stop-scrolling")&&(e="stop-scrolling-mobile"),$(this).is(":checked")?$("body").addClass(e):$("body").removeClass(e)})}function t(){a.on("click",function(){i()})}function n(e){i(),e&&$("html, body").scrollTop(e.offset().top)}function i(){r.prop("checked",!1).trigger("change")}var o,r,a;return{"init":function(){o=$(".overlay"),r=$(".js-overlay-trigger"),a=o.find(".js-close"),e(),t()},"close":t,"hide":i,"closeAndScrollTo":n}}(),StackExchange.mobile.uploader=function(){function e(){d.addClass("hidden-important"),u.removeClass("hidden-important").find('[type="url"]').focus()}function t(){d.removeClass("hidden-important"),u.addClass("hidden-important").find('[type="url"]').val("")}function n(){c.toggleClass("hidden-important"),$(".js-restart").toggleClass("hidden-important")}function i(e){1==e?f.find("figure").addClass("hidden-important").end().find("label").removeClass("hidden-important"):0==e&&f.find("figure").removeClass("hidden-important").end().find("label").addClass("hidden-important")}function o(){h.on("change",function(){var e=this;if(e.files&&e.files[0]){var t=new FileReader,o=e.files[0];t.onloadend=function(e){p.attr("src",e.target.result),v=o,i(!1),n()},t.readAsDataURL(o)}})}function r(){m.removeClass("loading"),l.val(""),h.val(""),v="",g.hide(),i(!0),t(),n()}function a(e){var t=$("#wmd-input"),n=t.val();n+="![enter image description here]("+e+")",t.val(n)}function s(){if(l.val().length)a(l.val()),r(),StackExchange.mobile.overlay.closeAndScrollTo(b);else if(v){var e=new window.FormData;g.hide(),m.addClass("loading"),e.append("file",v),e.append("fkey",StackExchange.options.user.fkey),$.ajax({"url":"/upload/image/json?https=true","data":e,"cache":!1,"contentType":!1,"processData":!1,"type":"POST","success":function(e){e&&e.Success?(a(e.UploadedImage),r(),StackExchange.mobile.overlay.closeAndScrollTo(b)):g.text(e.ErrorMessage).show()},"complete":function(){m.removeClass("loading")}})}}var c,u,l,d,f,p,h,g,m,v,b;return{"init":function(){m=$(".js-submit"),c=$(".js-image-url"),d=c.find(".js-image-url-info"),u=c.find(".js-image-url-field"),l=c.find("input[type=url]"),f=$(".js-area"),h=f.find(".js-image-input"),p=f.find("figure > img"),g=$(".uploader-error"),b=$('[data-role="uploader-scrolltotarget"]'),o(),$(".js-image-url-trigger").on("click",function(t){t.preventDefault(),e()}),$(".js-restart-trigger").on("click",function(e){e.preventDefault(),r()}),$(".js-image-url-cancel").on("click",function(e){e.preventDefault(),t()}),$(".js-close").on("click",function(){StackExchange.mobile.overlay.closeAndScrollTo(b)}),m.click(s)}}}();